<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple IoT Gun Control Dashboard</title>
    <link rel="stylesheet" href="css/style.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <h1><i class="fas fa-crosshairs"></i> IoT Gun Control Dashboard</h1>
      <div class="header-info">
        <div class="connection-status disconnected">Connecting...</div>
        <div class="time" id="current-time"></div>
      </div>
    </header>

    <!-- Main Dashboard -->
    <main class="dashboard">
      <!-- Quick Stats -->
      <div class="stats">
        <div class="stat-box">
          <h3>Hunters</h3>
          <div class="stat-number" id="hunters-count">8</div>
        </div>
        <div class="stat-box">
          <h3>Shots Today</h3>
          <div class="stat-number" id="shots-count">47</div>
        </div>
        <div class="stat-box">
          <h3>Bullets</h3>
          <div class="stat-number" id="bullets-count">1,250</div>
        </div>
      </div>

      <!-- Data Views -->
      <div class="data-views">
        <!-- Hunters View -->
        <div class="data-section">
          <h3><i class="fas fa-users"></i> Active Hunters</h3>
          <div class="hunters-list" id="hunters-list">
            <div class="loading">Loading hunters...</div>
          </div>
          <button class="add-btn" onclick="showAddHunter()">
            <i class="fas fa-plus"></i> Add Hunter
          </button>
        </div>

        <!-- IoT Guns -->
        <div class="data-section">
          <h3><i class="fas fa-crosshairs"></i> IoT Guns</h3>
          <div class="guns-list" id="guns-list">
            <div class="loading">Loading guns...</div>
          </div>
          <button class="add-btn" onclick="showAddGun()">
            <i class="fas fa-plus"></i> Register Gun
          </button>
        </div>

        <!-- Ammunition Inventory -->
        <div class="data-section">
          <h3><i class="fas fa-boxes"></i> Ammunition Inventory</h3>
          <div class="ammo-inventory" id="ammo-inventory">
            <div class="loading">Loading inventory...</div>
          </div>
          <button class="add-btn" onclick="showAddAmmo()">
            <i class="fas fa-plus"></i> Add Stock
          </button>
        </div>

        <!-- Recent Activities -->
        <div class="data-section">
          <h3><i class="fas fa-history"></i> Recent Activities</h3>
          <div class="activity-list" id="activity-list">
            <div class="loading">Loading activities...</div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="actions">
        <button class="action-btn" onclick="showAddHunter()">
          <i class="fas fa-user-plus"></i> Add Hunter
        </button>
        <button class="action-btn" onclick="showAddGun()">
          <i class="fas fa-crosshairs"></i> Register Gun
        </button>
        <button class="action-btn" onclick="showRecordShot()">
          <i class="fas fa-bullseye"></i> Record Shot
        </button>
        <button class="action-btn" onclick="showAddAmmo()">
          <i class="fas fa-boxes"></i> Add Ammo
        </button>
        <button
          class="action-btn simulation-btn"
          id="simulationBtn"
          onclick="toggleSimulation()"
        >
          <i class="fas fa-play"></i>
          <span id="simulationText">Start Simulation</span>
        </button>
        <button class="action-btn" onclick="retryConnection()">
          <i class="fas fa-wifi"></i> Retry Connection
        </button>
        <button class="action-btn" onclick="refreshData()">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>

      <!-- Shots Table with Filters -->
      <div class="shots-section">
        <h3><i class="fas fa-bullseye"></i> Shot Records</h3>

        <!-- Filters -->
        <div class="filters">
          <div class="filter-row">
            <div class="filter-group">
              <label for="hunterFilter">Hunter:</label>
              <select id="hunterFilter" onchange="filterShots()">
                <option value="">All Hunters</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="weaponFilter">Weapon:</label>
              <select id="weaponFilter" onchange="filterShots()">
                <option value="">All Weapons</option>
                <option value="rifle">Rifle</option>
                <option value="shotgun">Shotgun</option>
                <option value="handgun">Handgun</option>
                <option value="bow">Bow</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="locationFilter">Location:</label>
              <select id="locationFilter" onchange="filterShots()">
                <option value="">All Locations</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="dateFilter">Date:</label>
              <input type="date" id="dateFilter" onchange="filterShots()" />
            </div>
            <div class="filter-group">
              <button class="clear-filters" onclick="clearFilters()">
                Clear Filters
              </button>
            </div>
          </div>
        </div>

        <!-- Table -->
        <div class="table-container">
          <table class="shots-table" id="shots-table">
            <thead>
              <tr>
                <th class="sortable" onclick="sortTable('hunter')">
                  Hunter <span class="sort-arrow" id="sort-hunter"></span>
                </th>
                <th class="sortable" onclick="sortTable('timestamp')">
                  Timestamp <span class="sort-arrow" id="sort-timestamp"></span>
                </th>
                <th class="sortable" onclick="sortTable('location')">
                  Location <span class="sort-arrow" id="sort-location"></span>
                </th>
                <th class="sortable" onclick="sortTable('weapon')">
                  Weapon <span class="sort-arrow" id="sort-weapon"></span>
                </th>
                <th class="sortable" onclick="sortTable('sound')">
                  Sound Level <span class="sort-arrow" id="sort-sound"></span>
                </th>
                <th class="sortable" onclick="sortTable('vibration')">
                  Vibration <span class="sort-arrow" id="sort-vibration"></span>
                </th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="shots-list">
              <tr>
                <td colspan="7" class="loading">Loading shots...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="table-info">
          <span id="shots-count">0 shots</span>
          <button class="add-btn" onclick="showRecordShot()">
            <i class="fas fa-plus"></i> Record Shot
          </button>
        </div>
      </div>
    </main>

    <!-- Modals -->
    <!-- Add Hunter Modal -->
    <div id="addHunterModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('addHunterModal')"
          >&times;</span
        >
        <h2>Add New Hunter</h2>
        <form id="hunterForm">
          <div class="form-group">
            <label for="hunterName">Name:</label>
            <input type="text" id="hunterName" name="name" required />
          </div>
          <div class="form-group">
            <label for="licenseNumber">License Number:</label>
            <input
              type="text"
              id="licenseNumber"
              name="license_number"
              required
            />
          </div>

          <div class="form-group">
            <label for="currentLocation">Current Location:</label>
            <input
              type="text"
              id="currentLocation"
              name="current_location"
              required
            />
          </div>
          <div class="form-actions">
            <button type="button" onclick="closeModal('addHunterModal')">
              Cancel
            </button>
            <button type="submit">Add Hunter</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Record Shot Modal -->
    <div id="recordShotModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('recordShotModal')"
          >&times;</span
        >
        <h2>Record Shot</h2>
        <form id="shotForm">
          <div class="form-group">
            <label for="shotGun">Gun/Device:</label>
            <select id="shotGun" name="gun" required>
              <option value="">Select gun</option>
            </select>
          </div>
          <div class="form-group">
            <label for="soundLevel">Sound Level (dB):</label>
            <input
              type="number"
              id="soundLevel"
              name="sound_level"
              min="0"
              max="200"
              required
            />
          </div>
          <div class="form-group">
            <label for="vibrationLevel">Vibration Level (Hz):</label>
            <input
              type="number"
              id="vibrationLevel"
              name="vibration_level"
              min="0"
              max="100"
              required
            />
          </div>
          <div class="form-group">
            <label for="latitude">Latitude:</label>
            <input
              type="number"
              id="latitude"
              name="latitude"
              step="0.000001"
              required
            />
          </div>
          <div class="form-group">
            <label for="longitude">Longitude:</label>
            <input
              type="number"
              id="longitude"
              name="longitude"
              step="0.000001"
              required
            />
          </div>
          <div class="form-group">
            <label for="shotNotes">Notes:</label>
            <textarea id="shotNotes" name="notes" rows="3"></textarea>
          </div>
          <div class="form-actions">
            <button type="button" onclick="closeModal('recordShotModal')">
              Cancel
            </button>
            <button type="submit">Record Shot</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Ammunition Modal -->
    <div id="addAmmoModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('addAmmoModal')">&times;</span>
        <h2>Add Ammunition</h2>
        <form id="ammoForm">
          <div class="form-group">
            <label for="ammoType">Ammunition Type:</label>
            <select id="ammoType" name="ammo_type" required>
              <option value="">Select type</option>
              <option value="308">.308 Winchester</option>
              <option value="12g">12 Gauge</option>
              <option value="9mm">9mm Parabellum</option>
              <option value="22lr">.22 LR</option>
              <option value="223">.223 Remington</option>
              <option value="30-06">.30-06 Springfield</option>
              <option value="45acp">.45 ACP</option>
              <option value="270">.270 Winchester</option>
            </select>
          </div>
          <div class="form-group">
            <label for="ammoQuantity">Quantity:</label>
            <input
              type="number"
              id="ammoQuantity"
              name="quantity"
              min="1"
              required
            />
          </div>
          <div class="form-group">
            <label for="ammoLocation">Storage Location:</label>
            <input type="text" id="ammoLocation" name="location" required />
          </div>
          <div class="form-group">
            <label for="costPerUnit">Cost Per Unit ($):</label>
            <input
              type="number"
              id="costPerUnit"
              name="cost_per_unit"
              step="0.01"
              min="0"
            />
          </div>
          <div class="form-group">
            <label for="supplier">Supplier:</label>
            <input type="text" id="supplier" name="supplier" />
          </div>
          <div class="form-actions">
            <button type="button" onclick="closeModal('addAmmoModal')">
              Cancel
            </button>
            <button type="submit">Add Ammunition</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Gun Modal -->
    <div id="addGunModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('addGunModal')">&times;</span>
        <h2>Register IoT Gun</h2>
        <form id="gunForm">
          <div class="form-group">
            <label for="gunOwner">Owner:</label>
            <select id="gunOwner" name="owner" required>
              <option value="">Select owner</option>
            </select>
          </div>
          <div class="form-group">
            <label for="deviceId">Device ID:</label>
            <input
              type="text"
              id="deviceId"
              name="device_id"
              placeholder="IOT-GUN-001"
              required
            />
          </div>
          <div class="form-group">
            <label for="serialNumber">Serial Number:</label>
            <input
              type="text"
              id="serialNumber"
              name="serial_number"
              required
            />
          </div>
          <div class="form-group">
            <label for="gunMake">Make:</label>
            <input type="text" id="gunMake" name="make" required />
          </div>
          <div class="form-group">
            <label for="gunModel">Model:</label>
            <input type="text" id="gunModel" name="model" required />
          </div>
          <div class="form-group">
            <label for="caliber">Caliber:</label>
            <input
              type="text"
              id="caliber"
              name="caliber"
              placeholder=".308, 12ga, 9mm"
              required
            />
          </div>
          <div class="form-group">
            <label for="weaponType">Weapon Type:</label>
            <select id="weaponType" name="weapon_type" required>
              <option value="">Select type</option>
              <option value="rifle">Rifle</option>
              <option value="shotgun">Shotgun</option>
              <option value="handgun">Handgun</option>
              <option value="bow">Bow</option>
            </select>
          </div>
          <div class="form-group">
            <label for="batteryLevel">Battery Level (%):</label>
            <input
              type="number"
              id="batteryLevel"
              name="battery_level"
              min="0"
              max="100"
              value="100"
            />
          </div>
          <div class="form-group">
            <label for="firmwareVersion">Firmware Version:</label>
            <input
              type="text"
              id="firmwareVersion"
              name="firmware_version"
              placeholder="1.0.0"
            />
          </div>
          <div class="form-group">
            <label for="gunNotes">Notes:</label>
            <textarea id="gunNotes" name="notes" rows="3"></textarea>
          </div>
          <div class="form-actions">
            <button type="button" onclick="closeModal('addGunModal')">
              Cancel
            </button>
            <button type="submit">Register Gun</button>
          </div>
        </form>
      </div>
    </div>

    <script src="js/main.js"></script>
  </body>
</html>
